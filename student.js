const fullStudentInfo = {
  "40905333": {
    fullName: "Burhanuddin bhai Hatim bhai Kapasi",
    classId: "KG",
    mobileNo: "+918905621852",
    sanad: "",
    dob: "5/19/2020",
    hdob: "27/09/1441",
    teacher: "Batul bai Mulla Huzaifa bhai Badnagarwala"
  },
  "50221818": {
    fullName: "Insiya bai Mohammed bhai Divasali",
    classId: "ATFAAL",
    mobileNo: "+917878111152",
    sanad: "",
    dob: "12/31/2019",
    hdob: "5/05/1441",
    teacher: "Batul bai Mulla Huzaifa bhai Badnagarwala"
  },
  "40905340": {
    fullName: "Zainab bai Moiz bhai Hathyari",
    classId: "ATFAAL",
    mobileNo: "+919427283374",
    sanad: "",
    dob: "10/22/2019",
    hdob: "23/02/1441",
    teacher: "Batul bai Mulla Huzaifa bhai Badnagarwala"
  },
  "12345678": {
    fullName: "Burhanuddin bhai Aliasgar bhai Lati wala",
    classId: "1st",
    mobileNo: "",
    sanad: "",
    dob: "",
    hdob: "",
    teacher: "Batul bai Mulla Huzaifa bhai Badnagarwala"
  },
  "50221817": {
    fullName: "Hasan bhai Khuzaima bhai Kapasi",
    classId: "1st",
    mobileNo: "+919426978645",
    sanad: "",
    dob: "5/3/2019",
    hdob: "28/08/1440",
    teacher: "Batul bai Mulla Huzaifa bhai Badnagarwala"
  },
  "50221808": {
    fullName: "Sakina bai Asif bhai Tarvadi",
    classId: "1st",
    mobileNo: "+917383489790",
    sanad: "",
    dob: "6/9/2018",
    hdob: "26/09/1439",
    teacher: "Batul bai Mulla Huzaifa bhai Badnagarwala"
  },
  "50221819": {
    fullName: "Aliasgar bhai Husain bhai Sham",
    classId: "2nd",
    mobileNo: "+919825378105",
    sanad: "",
    dob: "9/24/2016",
    hdob: "22/12/1437",
    teacher: "Batul bai Mulla Huzaifa bhai Badnagarwala"
  },
  "40914838": {
    fullName: "Amatullah bai Mufaddal bhai Bharamal",
    classId: "2",
    mobileNo: "+917878611222",
    sanad: "Marhala Ula",
    dob: "11/18/2017",
    hdob: "29/02/1439",
    teacher: "Batul bai Mulla Huzaifa bhai Badnagarwala"
  },
  "50211046": {
    fullName: "Burhanuddin bhai Mohammed bhai Travadi",
    classId: "2",
    mobileNo: "+919428341972",
    sanad: "",
    dob: "11/18/2017",
    hdob: "29/02/1439",
    teacher: "Batul bai Mulla Huzaifa bhai Badnagarwala"
  },
  "40905326": {
    fullName: "Burhanuddin bhai Yunus bhai Tarvadi",
    classId: "2",
    mobileNo: "+919374960051",
    sanad: "",
    dob: "7/28/2017",
    hdob: "5/11/1438",
    teacher: "Batul bai Mulla Huzaifa bhai Badnagarwala"
  },
  "50221821": {
    fullName: "Jumana bai Firoz bhai Travadi",
    classId: "2",
    mobileNo: "+919428560703",
    sanad: "",
    dob: "12/7/2018",
    hdob: "29/03/1440",
    teacher: "Batul bai Mulla Huzaifa bhai Badnagarwala"
  },
  "40914839": {
    fullName: "Rukaiya bai Aliasgar bhai Bharmal",
    classId: "2",
    mobileNo: "+918733917777",
    sanad: "Surah Balad",
    dob: "4/7/2018",
    hdob: "22/07/1439",
    teacher: "Batul bai Mulla Huzaifa bhai Badnagarwala"
  },
  "50210961": {
    fullName: "Ummehani bai Aliasgar bhai Travadi",
    classId: "2",
    mobileNo: "+919426223786",
    sanad: "Surah Balad",
    dob: "4/7/2017",
    hdob: "11/07/1438",
    teacher: "Batul bai Mulla Huzaifa bhai Badnagarwala"
  },
  "50230696": {
    fullName: "Zainab bai Murtaza bhai Vanak",
    classId: "2",
    mobileNo: "+919016774452",
    sanad: "Surah Balad",
    dob: "8/8/2017",
    hdob: "16/11/1438",
    teacher: "Batul bai Mulla Huzaifa bhai Badnagarwala"
  },
  "40905323": {
    fullName: "Abizar bhai Burhanuddin bhai Khorakiwala",
    classId: "3",
    mobileNo: "+919638452110",
    sanad: "",
    dob: "12/24/2015",
    hdob: "13/03/1437",
    teacher: "Batul bai Mulla Huzaifa bhai Badnagarwala"
  },
  "50210588": {
    fullName: "Husain bhai Murtaza bhai Divasali",
    classId: "3",
    mobileNo: "+919773099918",
    sanad: "",
    dob: "3/17/2017",
    hdob: "19/06/1438",
    teacher: "Batul bai Mulla Huzaifa bhai Badnagarwala"
  },
  "40905330": {
    fullName: "Husen bhai Fakhruddin bhai Tarvadi",
    classId: "3",
    mobileNo: "+918690342261",
    sanad: "Surah Inshiqaq",
    dob: "6/23/2016",
    hdob: "18/09/1437",
    teacher: "Batul bai Mulla Huzaifa bhai Badnagarwala"
  },
  "50211036": {
    fullName: "Husen bhai Yusuf bhai Hirani",
    classId: "3",
    mobileNo: "+918733973520",
    sanad: "",
    dob: "1/22/2017",
    hdob: "24/04/1438",
    teacher: "Batul bai Mulla Huzaifa bhai Badnagarwala"
  },
  "50221823": {
    fullName: "Murtaza bhai Husain bhai Tarvadi",
    classId: "3",
    mobileNo: "+919825851952",
    sanad: "",
    dob: "6/16/2016",
    hdob: "11/09/1437",
    teacher: "Batul bai Mulla Huzaifa bhai Badnagarwala"
  },
  "50161003": {
    fullName: "Zahra bai Sadiq bhai Tarvadi",
    classId: "3",
    mobileNo: "+919825742727",
    sanad: "Surah Balad",
    dob: "3/23/2014",
    hdob: "22/05/1435",
    teacher: "Batul bai Mulla Huzaifa bhai Badnagarwala"
  },
  "50210589": {
    fullName: "Zainab bai Murtaza bhai Divasali",
    classId: "3",
    mobileNo: "+919773099918",
    sanad: "",
    dob: "3/21/2017",
    hdob: "23/06/1438",
    teacher: "Batul bai Mulla Huzaifa bhai Badnagarwala"
  },
  "50210964": {
    fullName: "Adnan bhai Murtaza bhai Makda",
    classId: "4",
    mobileNo: "+919427745773",
    sanad: "Surah Inshiqaq",
    dob: "5/1/2015",
    hdob: "13/07/1436",
    teacher: "Mulla Huzaifa bhai Yusuf bhai Badnagarwala"
  },
  "50221274": {
    fullName: "Ammar bhai Khuzaima bhai Thathya",
    classId: "4",
    mobileNo: "+917818914618",
    sanad: "Surah Balad",
    dob: "9/2/2013",
    hdob: "27/10/1434",
    teacher: "Mulla Huzaifa bhai Yusuf bhai Badnagarwala"
  },
  "50161649": {
    fullName: "Burhanuddin bhai Husain bhai Bharmal",
    classId: "4",
    mobileNo: "+919327988889",
    sanad: "Surah Balad",
    dob: "2/6/2015",
    hdob: "17/04/1436",
    teacher: "Mulla Huzaifa bhai Yusuf bhai Badnagarwala"
  },
  "50183863": {
    fullName: "Idris bhai Johar bhai Bharmal",
    classId: "4",
    mobileNo: "+919925874111",
    sanad: "",
    dob: "10/31/2012",
    hdob: "16/12/1433",
    teacher: "Mulla Huzaifa bhai Yusuf bhai Badnagarwala"
  },
  "50221822": {
    fullName: "Insiya bai Husain bhai Tarvadi",
    classId: "4",
    mobileNo: "+919825851952",
    sanad: "",
    dob: "7/14/2013",
    hdob: "7/09/1434",
    teacher: "Mulla Huzaifa bhai Yusuf bhai Badnagarwala"
  },
  "50182440": {
    fullName: "Mohammad bhai Taher bhai Kapasi",
    classId: "4",
    mobileNo: "+919904555100",
    sanad: "",
    dob: "10/30/2014",
    hdob: "7/01/1436",
    teacher: "Mulla Huzaifa bhai Yusuf bhai Badnagarwala"
  },
  "50181805": {
    fullName: "Mufaddal bhai Husain bhai Hathyari",
    classId: "4",
    mobileNo: "+917405229502",
    sanad: "Marhala Ula",
    dob: "7/14/2014",
    hdob: "17/09/1435",
    teacher: "Mulla Huzaifa bhai Yusuf bhai Badnagarwala"
  },
  "50180461": {
    fullName: "Tasnim bai Aqeel bhai Vakhariya",
    classId: "4",
    mobileNo: "+919662518652",
    sanad: "Marhala Ula",
    dob: "10/7/2014",
    hdob: "13/12/1435",
    teacher: "Mulla Huzaifa bhai Yusuf bhai Badnagarwala"
  },
  "40905325": {
    fullName: "Tasnim bai Moiz bhai Hathyari",
    classId: "4",
    mobileNo: "+919427283374",
    sanad: "Surah Inshiqaq",
    dob: "1/8/2016",
    hdob: "28/03/1437",
    teacher: "Mulla Huzaifa bhai Yusuf bhai Badnagarwala"
  },
  "50232407": {
    fullName: "Zahra bai Huzaifa bhai Kapasi",
    classId: "4",
    mobileNo: "+919157477860",
    sanad: "Surah Inshiqaq",
    dob: "3/3/2016",
    hdob: "24/05/1437",
    teacher: "Mulla Huzaifa bhai Yusuf bhai Badnagarwala"
  },
  "50193012": {
    fullName: "Batul bai Amiruddin bhai Vakhariyah",
    classId: "5",
    mobileNo: "+919925540200",
    sanad: "",
    dob: "12/22/2012",
    hdob: "9/02/1434",
    teacher: "Mulla Huzaifa bhai Yusuf bhai Badnagarwala"
  },
  "50203861": {
    fullName: "Batul bai Imran bhai Tarvadi",
    classId: "5",
    mobileNo: "+919377981895",
    sanad: "Surah Balad",
    dob: "6/9/2013",
    hdob: "1/08/1434",
    teacher: "Mulla Huzaifa bhai Yusuf bhai Badnagarwala"
  },
  "30160004": {
    fullName: "Burhanuddin bhai Baqir bhai Thathiya",
    classId: "5",
    mobileNo: "+916359153653",
    sanad: "Surah Inshiqaq",
    dob: "1/2/2015",
    hdob: "12/03/1436",
    teacher: "Mulla Huzaifa bhai Yusuf bhai Badnagarwala"
  },
  "40905320": {
    fullName: "Husain bhai Hatim bhai Kapasi",
    classId: "5",
    mobileNo: "+918905621852",
    sanad: "Surah Balad",
    dob: "9/21/2014",
    hdob: "27/11/1435",
    teacher: "Mulla Huzaifa bhai Yusuf bhai Badnagarwala"
  },
  "30160386": {
    fullName: "Insiya bai Mufaddal bhai Bharamal",
    classId: "5",
    mobileNo: "+917878611222",
    sanad: "Marhala Ula",
    dob: "9/26/2014",
    hdob: "2/12/1435",
    teacher: "Mulla Huzaifa bhai Yusuf bhai Badnagarwala"
  },
  "50221273": {
    fullName: "Jamila bai Khuzaima bhai Thathya",
    classId: "5",
    mobileNo: "+917818914618",
    sanad: "Marhala Ula",
    dob: "6/8/2012",
    hdob: "19/07/1433",
    teacher: "Mulla Huzaifa bhai Yusuf bhai Badnagarwala"
  },
  "50212138": {
    fullName: "Joon bhai Munavar bhai Travadi",
    classId: "5",
    mobileNo: "+919327949792",
    sanad: "Marhala Sania",
    dob: "8/17/2015",
    hdob: "3/11/1436",
    teacher: "Mulla Huzaifa bhai Yusuf bhai Badnagarwala"
  },
  "40912877": {
    fullName: "Joone bhai Husain bhai Bharmal",
    classId: "5",
    mobileNo: "+919327988889",
    sanad: "Surah Inshiqaq",
    dob: "9/18/2014",
    hdob: "24/11/1435",
    teacher: "Mulla Huzaifa bhai Yusuf bhai Badnagarwala"
  },
  "50180021": {
    fullName: "Jumana bai Burhanuddin bhai Khorakiwala",
    classId: "5",
    mobileNo: "+919638452110",
    sanad: "Surah Balad",
    dob: "3/8/2012",
    hdob: "15/04/1433",
    teacher: "Mulla Huzaifa bhai Yusuf bhai Badnagarwala"
  },
  "40914840": {
    fullName: "Mohammed bhai Aamir bhai Kapadia",
    classId: "5",
    mobileNo: "+919408622952",
    sanad: "Surah Balad",
    dob: "11/28/2014",
    hdob: "6/02/1436",
    teacher: "Mulla Huzaifa bhai Yusuf bhai Badnagarwala"
  },
  "50160563": {
    fullName: "Mohammed bhai Quraish bhai Divasali",
    classId: "5",
    mobileNo: "+917878653153",
    sanad: "Marhala Ula",
    dob: "5/11/2014",
    hdob: "12/07/1435",
    teacher: "Mulla Huzaifa bhai Yusuf bhai Badnagarwala"
  },
  "40905321": {
    fullName: "Saifuddin bhai Aqeel bhai Tarvadi",
    classId: "5",
    mobileNo: "+919327742177",
    sanad: "Marhala Ula",
    dob: "2/6/2014",
    hdob: "6/04/1435",
    teacher: "Mulla Huzaifa bhai Yusuf bhai Badnagarwala"
  },
  "40905324": {
    fullName: "Shirin bai Mulla Yusuf bhai Travadi",
    classId: "5",
    mobileNo: "+919426952786",
    sanad: "Surah Balad",
    dob: "12/11/2015",
    hdob: "29/02/1437",
    teacher: "Mulla Huzaifa bhai Yusuf bhai Badnagarwala"
  },
  "50192260": {
    fullName: "Zainab bai Aliasgar bhai Sadikot",
    classId: "5",
    mobileNo: "+919924046346",
    sanad: "",
    dob: "6/26/2015",
    hdob: "10/09/1436",
    teacher: "Mulla Huzaifa bhai Yusuf bhai Badnagarwala"
  },
  "40914834": {
    fullName: "Adnan bhai Fakhruddin bhai Tarvadi",
    classId: "6",
    mobileNo: "+919327319998",
    sanad: "Surah Inshiqaq",
    dob: "11/5/2012",
    hdob: "21/12/1433",
    teacher: "Mulla Huzaifa bhai Yusuf bhai Badnagarwala"
  },
  "40905319": {
    fullName: "Huzefa bhai Husain bhai Bharmal",
    classId: "6",
    mobileNo: "+919723193900",
    sanad: "Marhala Ula",
    dob: "12/19/2012",
    hdob: "6/02/1434",
    teacher: "Mulla Huzaifa bhai Yusuf bhai Badnagarwala"
  },
  "40920244": {
    fullName: "Insya bai Murtaza bhai Vanak",
    classId: "6",
    mobileNo: "+919016774452",
    sanad: "Surah Balad",
    dob: "9/21/2012",
    hdob: "6/11/1433",
    teacher: "Mulla Huzaifa bhai Yusuf bhai Badnagarwala"
  },
  "30152977": {
    fullName: "Yusuf bhai Munavar bhai Travadi",
    classId: "6",
    mobileNo: "+919909188952",
    sanad: "Surah Balad",
    dob: "10/25/2012",
    hdob: "10/12/1433",
    teacher: "Mulla Huzaifa bhai Yusuf bhai Badnagarwala"
  },
  "50161502": {
    fullName: "Zahra bai Aliasgar bhai Travadi",
    classId: "6",
    mobileNo: "+919426223786",
    sanad: "Marhala Ula",
    dob: "6/14/2013",
    hdob: "6/08/1434",
    teacher: "Mulla Huzaifa bhai Yusuf bhai Badnagarwala"
  },
  "50161648": {
    fullName: "Aamena bai Husain bhai Bharmal",
    classId: "7",
    mobileNo: "+919327988889",
    sanad: "Marhala Ula",
    dob: "4/20/2012",
    hdob: "29/05/1433",
    teacher: "Mulla Huzaifa bhai Yusuf bhai Badnagarwala"
  },
  "30151764": {
    fullName: "Aarefa bai Alihusain bhai Godit",
    classId: "7",
    mobileNo: "+919427281725",
    sanad: "Marhala Ula",
    dob: "3/20/2013",
    hdob: "9/05/1434",
    teacher: "Mulla Huzaifa bhai Yusuf bhai Badnagarwala"
  },
  "50160562": {
    fullName: "Fatema bai Mohammed bhai Divasali",
    classId: "7",
    mobileNo: "+917878111152",
    sanad: "Marhala Ula",
    dob: "6/19/2012",
    hdob: "30/07/1433",
    teacher: "Mulla Huzaifa bhai Yusuf bhai Badnagarwala"
  },
  "50161501": {
    fullName: "Malekulashter bhai Mohammed bhai Travadi",
    classId: "7",
    mobileNo: "+919375506225",
    sanad: "Surah Inshiqaq",
    dob: "12/18/2010",
    hdob: "12/01/1432",
    teacher: "Mulla Huzaifa bhai Yusuf bhai Badnagarwala"
  },
  "30919468": {
    fullName: "Husen bhai Hozefa bhai Thathiya",
    classId: "8",
    mobileNo: "+918140869852",
    sanad: "Marhala Ula",
    dob: "2/18/2010",
    hdob: "5/03/1431",
    teacher: "Mulla Huzaifa bhai Yusuf bhai Badnagarwala"
  },
  "30919464": {
    fullName: "Khadija bai Quraish bhai Divasali",
    classId: "8",
    mobileNo: "+917878653153",
    sanad: "Marhala Ula",
    dob: "9/21/2010",
    hdob: "13/10/1431",
    teacher: "Mulla Huzaifa bhai Yusuf bhai Badnagarwala"
  },
  "40905316": {
    fullName: "Mohamed bhai Abbas bhai Tarvadi",
    classId: "8",
    mobileNo: "+918140714780",
    sanad: "Marhala Ula",
    dob: "1/24/2011",
    hdob: "19/02/1432",
    teacher: "Mulla Huzaifa bhai Yusuf bhai Badnagarwala"
  },
  "30160002": {
    fullName: "Yusuf bhai Baqir bhai Thathiya",
    classId: "9",
    mobileNo: "+916359153653",
    sanad: "Marhala Ula",
    dob: "1/9/2011",
    hdob: "4/02/1432",
    teacher: "Mulla Huzaifa bhai Yusuf bhai Badnagarwala"
  }
};

let currentId = "";

function loginStudent() {
  const id = document.getElementById("studentId").value.trim();
  const student = fullStudentInfo[id];
  if (student) {
    currentId = id;
    document.getElementById("studentName").textContent = `Welcome, ${student.fullName}`;
    document.getElementById("loginSection").classList.add("hidden");
    document.getElementById("dashboardSection").classList.remove("hidden");
    loadStudentDetails(student);
    loadAttendance();
  } else {
    alert("Invalid ID!");
  }
}

function loadStudentDetails(s) {
  const table = document.getElementById("studentDetailsTable");
  table.innerHTML = `
    <tr><th>ITS ID</th><td>${currentId}</td></tr>
    <tr><th>Name</th><td>${s.fullName}</td></tr>
    <tr><th>Class</th><td>${s.classId}</td></tr>
    <tr><th>Mobile</th><td>${s.mobileNo}</td></tr>
    <tr><th>Mahad/Sanad</th><td>${s.sanad || "—"}</td></tr>
    <tr><th>DOB</th><td>${s.dob}</td></tr>
    <tr><th>Hijri DOB</th><td>${s.hdob}</td></tr>
    <tr><th>Class Teacher</th><td>${s.teacher}</td></tr>
  `;
}

function loadAttendance() {
  const tbody = document.getElementById("attendanceTable");
  tbody.innerHTML = "";
  for (let i = 0; i < localStorage.length; i++) {
    const key = localStorage.key(i);
    if (key.startsWith("attendance_")) {
      const data = JSON.parse(localStorage.getItem(key));
      if (data[currentId]) {
        const dateMatch = key.match(/attendance_(\d{4}-\d{2}-\d{2})/);
        if (dateMatch) {
          const row = document.createElement("tr");
          row.innerHTML = `<td>${dateMatch[1]}</td><td>${data[currentId]}</td>`;
          tbody.appendChild(row);
        }
      }
    }
  }
}

function submitLeave(e) {
  e.preventDefault();
  const from = document.getElementById("leaveFrom").value;
  const to = document.getElementById("leaveTo").value;
  const reason = document.getElementById("leaveReason").value.trim();
  const student = fullStudentInfo[currentId];

  if (!from || !to || !reason) {
    alert("Please fill all fields.");
    return;
  }

  const fromDate = new Date(from);
  const toDate = new Date(to);

  if (fromDate > toDate) {
    alert("Invalid date range.");
    return;
  }

  // Mark leave in attendance for each date
  let count = 0;
  const cls = student.classId;
  for (let d = new Date(fromDate); d <= toDate; d.setDate(d.getDate() + 1)) {
    const dateStr = d.toISOString().split("T")[0];
    const key = `attendance_teacher_class_${cls}_date_${dateStr}`;
    const keyAdmin = `attendance_admin_class_${cls}_date_${dateStr}`;
    
    [key, keyAdmin].forEach(storageKey => {
      const data = JSON.parse(localStorage.getItem(storageKey) || "{}");
      Object.keys(fullStudentInfo).forEach((sid, i) => {
        if (sid === currentId) data[i] = "🚫";
      });
      localStorage.setItem(storageKey, JSON.stringify(data));
    });

    count++;
  }

  const leaveRequests = JSON.parse(localStorage.getItem("leaveRequests") || "[]");
  leaveRequests.push({
    id: currentId,
    name: student.fullName,
    classId: student.classId,
    from,
    to,
    days: count,
    reason,
    time: new Date().toLocaleString()
  });
  localStorage.setItem("leaveRequests", JSON.stringify(leaveRequests));

  // Reset form
  document.getElementById("leaveFrom").value = "";
  document.getElementById("leaveTo").value = "";
  document.getElementById("leaveReason").value = "";
  document.getElementById("leaveSuccess").style.display = "block";
  setTimeout(() => {
    document.getElementById("leaveSuccess").style.display = "none";
  }, 3000);
}



function logout() {
  currentId = "";
  document.getElementById("dashboardSection").classList.add("hidden");
  document.getElementById("loginSection").classList.remove("hidden");
  document.getElementById("studentId").value = "";
}
